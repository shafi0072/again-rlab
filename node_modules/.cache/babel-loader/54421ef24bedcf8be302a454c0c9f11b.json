{"ast":null,"code":"import _pt from \"prop-types\";\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nimport React, { useContext, useCallback } from 'react';\nimport { getFirstItem, getSecondItem } from '@visx/shape/lib/util/accessors';\nimport getBandwidth from '@visx/shape/lib/util/getBandwidth';\nimport DataContext from '../../../context/DataContext';\nimport isValidNumber from '../../../typeguards/isValidNumber';\nimport { getStackValue } from '../../../utils/combineBarStackData';\nimport { BARSTACK_EVENT_SOURCE, XYCHART_EVENT_SOURCE } from '../../../constants';\nimport useSeriesEvents from '../../../hooks/useSeriesEvents';\nimport findNearestStackDatum from '../../../utils/findNearestStackDatum';\nimport useStackedData from '../../../hooks/useStackedData';\n\nfunction BaseBarStack(_ref) {\n  var children = _ref.children,\n      order = _ref.order,\n      offset = _ref.offset,\n      BarsComponent = _ref.BarsComponent,\n      onBlur = _ref.onBlur,\n      onFocus = _ref.onFocus,\n      onPointerMove = _ref.onPointerMove,\n      onPointerOut = _ref.onPointerOut,\n      onPointerUp = _ref.onPointerUp,\n      _ref$enableEvents = _ref.enableEvents,\n      enableEvents = _ref$enableEvents === void 0 ? true : _ref$enableEvents;\n\n  var _ref2 = useContext(DataContext),\n      colorScale = _ref2.colorScale,\n      dataRegistry = _ref2.dataRegistry,\n      horizontal = _ref2.horizontal,\n      xScale = _ref2.xScale,\n      yScale = _ref2.yScale;\n\n  var _useStackedData = useStackedData({\n    children: children,\n    order: order,\n    offset: offset\n  }),\n      seriesChildren = _useStackedData.seriesChildren,\n      dataKeys = _useStackedData.dataKeys,\n      stackedData = _useStackedData.stackedData; // custom logic to find the nearest AreaStackDatum (context) and return the original Datum (props)\n\n\n  var findNearestDatum = useCallback(function (params) {\n    var _seriesChildren$find, _seriesChildren$find$;\n\n    var childData = (_seriesChildren$find = seriesChildren.find(function (child) {\n      return child.props.dataKey === params.dataKey;\n    })) == null ? void 0 : (_seriesChildren$find$ = _seriesChildren$find.props) == null ? void 0 : _seriesChildren$find$.data;\n    return childData ? findNearestStackDatum(params, childData, horizontal) : null;\n  }, [seriesChildren, horizontal]);\n  var ownEventSourceKey = BARSTACK_EVENT_SOURCE + \"-\" + dataKeys.join('-');\n  var eventEmitters = useSeriesEvents({\n    dataKey: dataKeys,\n    enableEvents: enableEvents,\n    // @ts-ignore Datum input + return type are expected to be the same type but they differ for BarStack (registry data is StackedDatum, return type is user Datum)\n    findNearestDatum: findNearestDatum,\n    onBlur: onBlur,\n    onFocus: onFocus,\n    onPointerMove: onPointerMove,\n    onPointerOut: onPointerOut,\n    onPointerUp: onPointerUp,\n    source: ownEventSourceKey,\n    allowedSources: [XYCHART_EVENT_SOURCE, ownEventSourceKey]\n  }); // if scales and data are not available in the registry, bail\n\n  if (dataKeys.some(function (key) {\n    return dataRegistry.get(key) == null;\n  }) || !xScale || !yScale || !colorScale) {\n    return null;\n  }\n\n  var barThickness = getBandwidth(horizontal ? yScale : xScale);\n  var halfBarThickness = barThickness / 2;\n  var getWidth;\n  var getHeight;\n  var getX;\n  var getY;\n\n  if (horizontal) {\n    getWidth = function getWidth(bar) {\n      var _xScale, _xScale2;\n\n      return ((_xScale = xScale(getSecondItem(bar))) != null ? _xScale : NaN) - ((_xScale2 = xScale(getFirstItem(bar))) != null ? _xScale2 : NaN);\n    };\n\n    getHeight = function getHeight() {\n      return barThickness;\n    };\n\n    getX = function getX(bar) {\n      return xScale(getFirstItem(bar));\n    };\n\n    getY = function getY(bar) {\n      var _yScale;\n\n      return 'bandwidth' in yScale ? yScale(getStackValue(bar.data)) : Math.max(((_yScale = yScale(getStackValue(bar.data))) != null ? _yScale : NaN) - halfBarThickness);\n    };\n  } else {\n    getWidth = function getWidth() {\n      return barThickness;\n    };\n\n    getHeight = function getHeight(bar) {\n      var _yScale2, _yScale3;\n\n      return ((_yScale2 = yScale(getFirstItem(bar))) != null ? _yScale2 : NaN) - ((_yScale3 = yScale(getSecondItem(bar))) != null ? _yScale3 : NaN);\n    };\n\n    getX = function getX(bar) {\n      var _xScale3;\n\n      return 'bandwidth' in xScale ? xScale(getStackValue(bar.data)) : Math.max(((_xScale3 = xScale(getStackValue(bar.data))) != null ? _xScale3 : NaN) - halfBarThickness);\n    };\n\n    getY = function getY(bar) {\n      return yScale(getSecondItem(bar));\n    };\n  }\n\n  var bars = stackedData.flatMap(function (barStack, stackIndex) {\n    var _barSeries$props;\n\n    var entry = dataRegistry.get(barStack.key);\n    if (!entry) return null; // get colorAccessor from child BarSeries, if available\n\n    var barSeries = seriesChildren.find(function (child) {\n      return child.props.dataKey === barStack.key;\n    });\n    var colorAccessor = barSeries == null ? void 0 : (_barSeries$props = barSeries.props) == null ? void 0 : _barSeries$props.colorAccessor;\n    return barStack.map(function (bar, index) {\n      var _barSeries$props2;\n\n      var barX = getX(bar);\n      if (!isValidNumber(barX)) return null;\n      var barY = getY(bar);\n      if (!isValidNumber(barY)) return null;\n      var barWidth = getWidth(bar);\n      if (!isValidNumber(barWidth)) return null;\n      var barHeight = getHeight(bar);\n      if (!isValidNumber(barHeight)) return null;\n      var barSeriesDatum = colorAccessor ? barSeries == null ? void 0 : (_barSeries$props2 = barSeries.props) == null ? void 0 : _barSeries$props2.data[index] : null;\n      return {\n        key: stackIndex + \"-\" + barStack.key + \"-\" + index,\n        x: barX,\n        y: barY,\n        width: barWidth,\n        height: barHeight,\n        fill: barSeriesDatum && colorAccessor ? colorAccessor(barSeriesDatum, index) : colorScale(barStack.key)\n      };\n    });\n  }).filter(function (bar) {\n    return bar;\n  });\n  return /*#__PURE__*/React.createElement(\"g\", {\n    className: \"visx-bar-stack\"\n  }, /*#__PURE__*/React.createElement(BarsComponent, _extends({\n    bars: bars,\n    horizontal: horizontal,\n    xScale: xScale,\n    yScale: yScale\n  }, eventEmitters)));\n}\n\nBaseBarStack.propTypes = {\n  children: _pt.oneOfType([_pt.element, _pt.arrayOf(_pt.element)]).isRequired\n};\nexport default BaseBarStack;","map":{"version":3,"sources":["C:/remotePackRlab-acab49ee44aa8f06acbfc147116dbc3387885161/node_modules/@visx/xychart/esm/components/series/private/BaseBarStack.js"],"names":["_pt","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","React","useContext","useCallback","getFirstItem","getSecondItem","getBandwidth","DataContext","isValidNumber","getStackValue","BARSTACK_EVENT_SOURCE","XYCHART_EVENT_SOURCE","useSeriesEvents","findNearestStackDatum","useStackedData","BaseBarStack","_ref","children","order","offset","BarsComponent","onBlur","onFocus","onPointerMove","onPointerOut","onPointerUp","_ref$enableEvents","enableEvents","_ref2","colorScale","dataRegistry","horizontal","xScale","yScale","_useStackedData","seriesChildren","dataKeys","stackedData","findNearestDatum","params","_seriesChildren$find","_seriesChildren$find$","childData","find","child","props","dataKey","data","ownEventSourceKey","join","eventEmitters","allowedSources","some","get","barThickness","halfBarThickness","getWidth","getHeight","getX","getY","bar","_xScale","_xScale2","NaN","_yScale","Math","max","_yScale2","_yScale3","_xScale3","bars","flatMap","barStack","stackIndex","_barSeries$props","entry","barSeries","colorAccessor","map","index","_barSeries$props2","barX","barY","barWidth","barHeight","barSeriesDatum","x","y","width","height","fill","filter","createElement","className","propTypes","oneOfType","element","arrayOf","isRequired"],"mappings":"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","sourcesContent":["import _pt from \"prop-types\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React, { useContext, useCallback } from 'react';\nimport { getFirstItem, getSecondItem } from '@visx/shape/lib/util/accessors';\nimport getBandwidth from '@visx/shape/lib/util/getBandwidth';\nimport DataContext from '../../../context/DataContext';\nimport isValidNumber from '../../../typeguards/isValidNumber';\nimport { getStackValue } from '../../../utils/combineBarStackData';\nimport { BARSTACK_EVENT_SOURCE, XYCHART_EVENT_SOURCE } from '../../../constants';\nimport useSeriesEvents from '../../../hooks/useSeriesEvents';\nimport findNearestStackDatum from '../../../utils/findNearestStackDatum';\nimport useStackedData from '../../../hooks/useStackedData';\n\nfunction BaseBarStack(_ref) {\n  var children = _ref.children,\n      order = _ref.order,\n      offset = _ref.offset,\n      BarsComponent = _ref.BarsComponent,\n      onBlur = _ref.onBlur,\n      onFocus = _ref.onFocus,\n      onPointerMove = _ref.onPointerMove,\n      onPointerOut = _ref.onPointerOut,\n      onPointerUp = _ref.onPointerUp,\n      _ref$enableEvents = _ref.enableEvents,\n      enableEvents = _ref$enableEvents === void 0 ? true : _ref$enableEvents;\n\n  var _ref2 = useContext(DataContext),\n      colorScale = _ref2.colorScale,\n      dataRegistry = _ref2.dataRegistry,\n      horizontal = _ref2.horizontal,\n      xScale = _ref2.xScale,\n      yScale = _ref2.yScale;\n\n  var _useStackedData = useStackedData({\n    children: children,\n    order: order,\n    offset: offset\n  }),\n      seriesChildren = _useStackedData.seriesChildren,\n      dataKeys = _useStackedData.dataKeys,\n      stackedData = _useStackedData.stackedData; // custom logic to find the nearest AreaStackDatum (context) and return the original Datum (props)\n\n\n  var findNearestDatum = useCallback(function (params) {\n    var _seriesChildren$find, _seriesChildren$find$;\n\n    var childData = (_seriesChildren$find = seriesChildren.find(function (child) {\n      return child.props.dataKey === params.dataKey;\n    })) == null ? void 0 : (_seriesChildren$find$ = _seriesChildren$find.props) == null ? void 0 : _seriesChildren$find$.data;\n    return childData ? findNearestStackDatum(params, childData, horizontal) : null;\n  }, [seriesChildren, horizontal]);\n  var ownEventSourceKey = BARSTACK_EVENT_SOURCE + \"-\" + dataKeys.join('-');\n  var eventEmitters = useSeriesEvents({\n    dataKey: dataKeys,\n    enableEvents: enableEvents,\n    // @ts-ignore Datum input + return type are expected to be the same type but they differ for BarStack (registry data is StackedDatum, return type is user Datum)\n    findNearestDatum: findNearestDatum,\n    onBlur: onBlur,\n    onFocus: onFocus,\n    onPointerMove: onPointerMove,\n    onPointerOut: onPointerOut,\n    onPointerUp: onPointerUp,\n    source: ownEventSourceKey,\n    allowedSources: [XYCHART_EVENT_SOURCE, ownEventSourceKey]\n  }); // if scales and data are not available in the registry, bail\n\n  if (dataKeys.some(function (key) {\n    return dataRegistry.get(key) == null;\n  }) || !xScale || !yScale || !colorScale) {\n    return null;\n  }\n\n  var barThickness = getBandwidth(horizontal ? yScale : xScale);\n  var halfBarThickness = barThickness / 2;\n  var getWidth;\n  var getHeight;\n  var getX;\n  var getY;\n\n  if (horizontal) {\n    getWidth = function getWidth(bar) {\n      var _xScale, _xScale2;\n\n      return ((_xScale = xScale(getSecondItem(bar))) != null ? _xScale : NaN) - ((_xScale2 = xScale(getFirstItem(bar))) != null ? _xScale2 : NaN);\n    };\n\n    getHeight = function getHeight() {\n      return barThickness;\n    };\n\n    getX = function getX(bar) {\n      return xScale(getFirstItem(bar));\n    };\n\n    getY = function getY(bar) {\n      var _yScale;\n\n      return 'bandwidth' in yScale ? yScale(getStackValue(bar.data)) : Math.max(((_yScale = yScale(getStackValue(bar.data))) != null ? _yScale : NaN) - halfBarThickness);\n    };\n  } else {\n    getWidth = function getWidth() {\n      return barThickness;\n    };\n\n    getHeight = function getHeight(bar) {\n      var _yScale2, _yScale3;\n\n      return ((_yScale2 = yScale(getFirstItem(bar))) != null ? _yScale2 : NaN) - ((_yScale3 = yScale(getSecondItem(bar))) != null ? _yScale3 : NaN);\n    };\n\n    getX = function getX(bar) {\n      var _xScale3;\n\n      return 'bandwidth' in xScale ? xScale(getStackValue(bar.data)) : Math.max(((_xScale3 = xScale(getStackValue(bar.data))) != null ? _xScale3 : NaN) - halfBarThickness);\n    };\n\n    getY = function getY(bar) {\n      return yScale(getSecondItem(bar));\n    };\n  }\n\n  var bars = stackedData.flatMap(function (barStack, stackIndex) {\n    var _barSeries$props;\n\n    var entry = dataRegistry.get(barStack.key);\n    if (!entry) return null; // get colorAccessor from child BarSeries, if available\n\n    var barSeries = seriesChildren.find(function (child) {\n      return child.props.dataKey === barStack.key;\n    });\n    var colorAccessor = barSeries == null ? void 0 : (_barSeries$props = barSeries.props) == null ? void 0 : _barSeries$props.colorAccessor;\n    return barStack.map(function (bar, index) {\n      var _barSeries$props2;\n\n      var barX = getX(bar);\n      if (!isValidNumber(barX)) return null;\n      var barY = getY(bar);\n      if (!isValidNumber(barY)) return null;\n      var barWidth = getWidth(bar);\n      if (!isValidNumber(barWidth)) return null;\n      var barHeight = getHeight(bar);\n      if (!isValidNumber(barHeight)) return null;\n      var barSeriesDatum = colorAccessor ? barSeries == null ? void 0 : (_barSeries$props2 = barSeries.props) == null ? void 0 : _barSeries$props2.data[index] : null;\n      return {\n        key: stackIndex + \"-\" + barStack.key + \"-\" + index,\n        x: barX,\n        y: barY,\n        width: barWidth,\n        height: barHeight,\n        fill: barSeriesDatum && colorAccessor ? colorAccessor(barSeriesDatum, index) : colorScale(barStack.key)\n      };\n    });\n  }).filter(function (bar) {\n    return bar;\n  });\n  return /*#__PURE__*/React.createElement(\"g\", {\n    className: \"visx-bar-stack\"\n  }, /*#__PURE__*/React.createElement(BarsComponent, _extends({\n    bars: bars,\n    horizontal: horizontal,\n    xScale: xScale,\n    yScale: yScale\n  }, eventEmitters)));\n}\n\nBaseBarStack.propTypes = {\n  children: _pt.oneOfType([_pt.element, _pt.arrayOf(_pt.element)]).isRequired\n};\nexport default BaseBarStack;"]},"metadata":{},"sourceType":"module"}